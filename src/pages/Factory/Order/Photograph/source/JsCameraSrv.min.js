!function(e,t,a,i){e.fn.getCursorPosition=function(){var i=e(this).get(0),n=0
if("selectionStart"in i)n=i.selectionStart
else if("selection"in a){i.focus()
var r=a.selection.createRange(),s=a.selection.createRange().text.length
r.moveStart("character",-i.value.length),n=r.text.length-s}else{if(a.all)i.range=a.selection.createRange(),i.range.select(),i.range.moveStart("character",-1)
else i.range=t.getSelection().getRangeAt(0)
n=i.range.endOffset}return n}}(jQuery,window,document),function(e,t,a,i){t.ZK_JSC={},ZK_JSC.ParamData=[],ZK_JSC.PrivateData=[],ZK_JSC.PreviewData=[],ZK_JSC.TemplData={name:null,params:null,preview:null,"private":null},ZK_JSC.TemplsData=[{name:"新增","private":[{width:0,height:0,top:0,left:0,alias:"",type:"bgimage",align:"flex-start"}],preview:['<div class="bgimage"></div>'],params:[{name:"模板名",value:""},{name:"类型",type:"combo",value:""},{name:"名称",type:"combo",value:"",lists:""},{name:"分辨率",type:"combo",value:"",lists:""},{name:"格式",type:"combo",value:"",lists:"MJPG,RGB24,RGB32,RGB8,YUY2"}]}],ZK_JSC.CameraList="",ZK_JSC.CameraInfo=[],ZK_JSC.httpPrefix="http://localhost:9528/",ZK_JSC.textPrefix="JsCameraSrv",function(){var t=ZK_JSC.Http=function(){var e=this
e.httpPrefix=ZK_JSC.httpPrefix}
t.prototype={AjaxGetHandle:function(t,a,n){var r,s,l=this
if(a==i||null==a)s={}
else s=a
r=l.httpPrefix+t,e.ajax({url:r,timeout:1e4,dataType:"json",data:s,type:"get",success:function(t){if("function"==typeof n)t=e.extend(t,{status:200}),n(t)},error:function(e){if("function"==typeof n)n(e)}})},AjaxPostHandle:function(t,a,i){var n,r=this
n=r.httpPrefix+t,e.ajax({url:n,timeout:1e4,contentType:"multipart/form-data",processData:!1,dataType:"json",data:a,traditional:!0,type:"post",success:function(t){if("function"==typeof i)t=e.extend(t,{status:200}),i(t)},error:function(e){if("function"==typeof i)i(e)}})}}}(),function(){var a=ZK_JSC.Form=function(e){var t=this
if(t.formContainer=e,null==e)t.formContainer="body"}
a.prototype={create:function(t,a,i){var n=this
if(!e(n.contentWrapper).length)n._setupWindow(),n._setTitle(t),n._setSize(a,i),n._insertListener()},setupBtns:function(t,a,n,r){var s=this,l=!1
if(htmlTextBtn='<div class="ZK-winbtn"></div>',r==i)r=!0
if(s.callback=a,s.handler=n,t!=i){if("string"==typeof t&&""!=t)return
else if("object"==typeof t&&0==t.length)return
if(r)e(s.formContainer+" .ZK-winframe .ZK-winbtn").remove()
if(0==e(s.formContainer+" .ZK-winframe .ZK-winbtn").length)e(s.formContainer+" .ZK-winframe").append(htmlTextBtn)
else l=!0
if("string"==typeof t&&""!=t)if(htmlText='<div class="btn"><span>'+t+"</span></div>",l)e(s.formContainer+" .ZK-winframe .ZK-winbtn").prepend(htmlText)
else e(s.formContainer+" .ZK-winframe .ZK-winbtn").append(htmlText)
else if("object"==typeof t)t.forEach(function(t,a){if(""==t)return!1
if(!s._isBtnExisted(t))if(htmlText='<div class="btn"><span>'+t+"</span></div>",l)e(s.formContainer+" .ZK-winframe .ZK-winbtn").prepend(htmlText)
else e(s.formContainer+" .ZK-winframe .ZK-winbtn").append(htmlText)})}},setBtnDisable:function(t,a){var n,r,s,l=this
if(a==i)a=!0
n=e(l.formContainer+" .ZK-winframe .ZK-winbtn .btn"),n.each(function(i,n){if(r=e(n).find("span")[0],s=e(r).text(),s==t)if(a)e(n).addClass("disable")
else e(n).removeClass("disable")})},show:function(){var t=this
e(t.formContainer+" .ZK-winframe").css("visibility","visible")},hide:function(){var t=this
e(t.formContainer+" .ZK-winframe").css("visibility","hidden")},close:function(){var t=this
e(t.formContainer+" .ZK-winframe").remove()},getContentWarpper:function(){var e=this
return e.contentWrapper},showBusyMask:function(t,a,n,r){var s,l='<div class="ZK-mask" contenteditable="true"><div class="ZK-popup"><div class="popupcontent"><div class="imageloading"></div><div class="text"></div></div></div></div>'
if(r==i)r=0
if(s=t,null==s)s="body"
if(a==i||""==a)e(s+" .ZK-mask").remove()
else{if(e(s+" div.ZK-mask").length)e(s+" .ZK-mask").remove()
e(s).append(l),e(s+" .ZK-mask .text").text(a)}switch(n){case"warning":e(s+" .ZK-mask .imageloading").removeClass("imageloading").addClass("imagewarning")
break
case"error":e(s+" .ZK-mask .imageloading").removeClass("imageloading").addClass("imageerror")}if(0!=r)setTimeout(function(){e(s+" .ZK-mask").remove()},r)
else e(s+" .ZK-mask").focus(),e(s+" .ZK-mask").on("click keyup",function(t){t.stopPropagation(),t.preventDefault(),e(s+" .ZK-mask").remove()})},_setupWindow:function(t){var a=this,i='<div id="JsPrintSrvWin" class="ZK-winframe"><div class="ZK-wintitle"><div class="title">JsPrintSrv</div><div class="closebtn"></div></div><div class="ZK-contentwrapper"></div></div>'
e(a.formContainer).append(i),a.contentWrapper=a.formContainer+" .ZK-contentwrapper"},_setSize:function(a,i){var n=this,r=e(t).width(),s=e(t).height()
if(!(0>a||0>i||a>100||i>100)){if(null==a)n.formWidth=.8*r
else n.formWidth=r*a/100
if(e(n.formContainer+" .ZK-winframe").width(n.formWidth),null==i)n.formHeight=.8*s
else n.formHeight=s*i/100
e(n.formContainer+" .ZK-winframe").height(n.formHeight)}},_setTitle:function(t){var a=this
a.formTitle=ZK_JSC.textPrefix+" "+t,e(a.formContainer+" .ZK-wintitle .title").text(a.formTitle)},_insertListener:function(){var t=this
e(t.formContainer+" .ZK-wintitle").on("click","div.closebtn",function(){t.close()}),e(t.formContainer+" .ZK-winframe").on("mouseenter","div.btn",function(){if(!e(this).hasClass("disable"))e(this).addClass("hover")}).on("mouseleave","div.btn",function(){e(this).removeClass("hover")}),e(t.formContainer+" .ZK-winframe").on("click","div.btn",function(){if("function"==typeof t.callback&&!e(this).hasClass("disable"))t.callback(t.handler,e(this).text())})},_isBtnExisted:function(t){var a=this,i=!1,n=e(a.formContainer+" .ZK-winframe .ZK-winbtn").children()
if(0==n.length)return!1
else return e(n).each(function(a,n){if(e(n).text()==t)i=!0}),i}}}(),function(){var a=ZK_JSC.Templ=function(t){var a=this,i='<div class="templpreview"></div>'
a.selectedEle=null,a.templWrapper=t,e(a.templWrapper).append(i),a.setupMenu(),a.setContentArea(),e(a.templWrapper+" .left").css("width","auto"),a._insertListener()}
a.prototype={setMenuDisable:function(t,a){var n
if(a==i)a=!0
if(n=e(".ZK-contentwrapper .menu .menuitem"),n.length)n.each(function(i,n){if(itemClass=e(n).find("img").attr("class"),-1!=itemClass.indexOf(t)){if(a)itemClass=t+" disable"
else itemClass=t
return e(n).find("img").attr("class",itemClass),!1}})},setMenuEditStatus:function(t,a){var i=e(".ZK-contentwrapper .templpreview .menu .delete")
if(a)i.removeClass("disable")
else i.addClass("disable")},setupMenu:function(){var t=this,a='<div class="menu"><div class="menugroup"><div class="menuitem"><image class="bgimage"/><input id="bgImage" class="filedialog" type="file" accept="image/gif,image/jpeg,image/png,image/jpg"/></div><div class="menuitem"><image class="bgremove disable"/></div></div><div class="menugroup"><div class="menuitem"><image class="rect"/></div><div class="menuitem"><image class="delete disable"/></div></div></div></div><div class="menu"><div class="menugroup">宽<div id="elementWidth" tabindex="0" class="keypress1 menuinput" contenteditable="false">0</div></div><div class="menugroup">高<div id="elementHeight" class="keypress1 menuinput" tabindex="1" contenteditable="false">0</div></div><div class="menugroup">上<div id="elementTop" class="keypress1 menuinput" tabindex="2" contenteditable="false">0</div></div><div class="menugroup">左<div id="elementLeft" class="keypress1 menuinput" tabindex="3" contenteditable="false">0</div></div><div class="menugroup">别名<div id="elementAlias" class="keypress2 menuinput menualias" tabindex="4" contenteditable="false"></div></div></div>'
e(t.templWrapper+" .templpreview").append(a)},setContentArea:function(){var t=this,a='<div class="contentarea"><div class="left"><div class="paperframe"><div class="validarea" contenteditable="true" tabindex="0"><div class="bgimage"></div></div></div><div class="measures"></div></div><div class="right"><div class="measures"></div><div class="padding"></div></div><div class="append"></div></div>'
e(t.templWrapper+" .templpreview").append(a),t._dragResizeInit()},_loadBgImage:function(t){var a=this
if(ZK_JSC.Templ.prototype.setMenuDisable("bgremove",!1),typeof FileReader!=i)if(a.files.length){var n=a.files[0]
imgFileName=n.name,e(a).val("")
var r=new FileReader
r.readAsDataURL(n),r.onload=function(t){function a(){var t=ZK_JSC.ViewSetup.templObj,a=e(".ZK-contentwrapper .left .validarea .bgimage"),r='<img id="ZK_BgImage"/>'
a.children().remove(),a.append(r)
var s=a.data("c")
s.width=i.width,s.height=i.height,a.data("c",s),a=e(".ZK-contentwrapper .left .validarea .bgimage #ZK_BgImage"),a.attr("src",i.data),a.attr("alt",n.name),t._setupValidArea(t),a.show()}var i=new Image
i.src=t.target.result,i.data=t.target.result,i.onload=a},t.target.value=""}},_setupValidArea:function(t){var a,i,n,r,s,l=t,o=0
return e(l.templWrapper+" .left").css("width","100%"),i=e(l.templWrapper+" .validarea"),n=e(l.templWrapper+" .validarea .bgimage"),a=n.data("c"),r=i.width(),o=parseFloat(r/a.width),s=a.height*o,l.sizeValidArea={x:r,y:s},i.height(l.sizeValidArea.y),l.cordFactor=o,o},_addTemplElement:function(t){var a,i=this,n=e(i.templWrapper+" .paperframe .validarea")
switch(elementId="userElement",htmlText="",elementId+=i._getEleItemCount()+1,t){case"rect":a={width:40,height:20,top:0,left:0,type:"rect",alias:"",align:""},htmlText="<div id="+elementId+' class="newelement drsElement drsMoveHandle rect"></div>',n.append(htmlText),i._setTemplEleStyle(e(i.templWrapper+" .paperframe .validarea #"+elementId),a)}e(i.selectedEle).find(".dragresize").css("visibility","hidden"),i._dragResizeBlur(i,i.selectedEle),i.selectedEle=e(i.templWrapper+" .paperframe .validarea #"+elementId)},_getEleItemCount:function(){var t=this,a=e(t.templWrapper+" .paperframe .validarea"),i=0
return i=a.find("div.newelement").length},_setTemplEleStyle:function(t,a){var i=this,n=0,r=0
if(t.data("c",a),"object"!=typeof a)return!1
for(key in a)switch(key){case"width":n=i._convertActualPix(a[key]),r=e(i.templWrapper+" .paperframe .validarea").width(),t.css(key,n>r?r:n)
break
case"height":n=i._convertActualPix(a[key]),r=e(i.templWrapper+" .paperframe .validarea").height(),t.css(key,n>r?r:n)
break
case"top":case"left":t.css(key,parseInt(i._convertActualPix(a[key]))+"px")
break
case"align":t.css("justify-content",a[key])
break
case"text":var s=t.find("span")[0]
e(s).text(a[key])
break
case"alias":}},_convertActualPix:function(e){var t=this,a=0
return a=(parseFloat(e)/t.cordFactor).toFixed(0)},setPreviewContent:function(t){var a,n=this,r=e(n.templWrapper+" .paperframe .validarea")
r.children().remove(),r.append(t),a=r.children(),e.each(a,function(t,a){if(e(a).hasClass("bgimage"))if(""!=e(e(a).find("img")[0]).attr("src")&&e(e(a).find("img")[0]).attr("src")!=i)n.setMenuDisable("bgremove",!1)})},setPreviewPrivate:function(t){var a=this,n=e(a.templWrapper+" .paperframe .validarea").children()
n.each(function(n,r){if(typeof t[n]!=i)e(r).data("c",t[n])
if(e(r).hasClass("bgimage"))a._setupValidArea(a)})},getPreviewContent:function(){var t=this,a=e(t.templWrapper+" .paperframe .validarea"),i=[]
return a.find(".rect").children().remove(),a.find(".dragresize").remove(),a.find(".drsElementSelected").removeClass("drsElementSelected"),a.children().each(function(t,a){i.push(e(a).prop("outerHTML"))}),i},getPreviewPrivate:function(){var t,a=this,i=e(a.templWrapper+" .paperframe .validarea").children(),n=[]
return i.each(function(a,i){t=e(i).data("c"),n.push(t)}),n},_updateMenuInputValue:function(t){var a,n=e(".ZK-contentwrapper .templpreview .menu #elementWidth"),r=e(".ZK-contentwrapper .templpreview .menu #elementHeight"),s=e(".ZK-contentwrapper .templpreview .menu #elementTop"),l=e(".ZK-contentwrapper .templpreview .menu #elementLeft"),o=e(".ZK-contentwrapper .templpreview .menu #elementAlias"),a=e(t).data("c")
if(a!=i)if(n.text(a.width),r.text(a.height),s.text(a.top),l.text(a.left),o.text(a.alias),n.addClass("editable").attr("contenteditable","true"),r.addClass("editable").attr("contenteditable","true"),s.addClass("editable").attr("contenteditable","true"),l.addClass("editable").attr("contenteditable","true"),!e(t).hasClass("bgimage"))o.addClass("editable").attr("contenteditable","true")},_dragResizeInit:function(){var a=this,i=e(".ZK-contentwrapper .paperframe .validarea"),n=new DragResize("dragresize",{minWidth:1,minHeight:1,minLeft:0,minTop:0,maxLeft:i.width(),wrapper:a})
n.isElement=function(e){if(e.className&&e.className.indexOf("drsElement")>-1)return!0
else;},n.isHandle=function(e){if(e.className&&e.className.indexOf("drsMoveHandle")>-1)return!0
else;},n.ondragstart=function(e,t){},n.ondragfocus=a._dragResizeFocus,n.ondragmove=a._dragResizeMove,n.ondragend=a._dragResizeEnd,n.ondragblur=a._dragResizeBlur,n.apply(t)},_dragResizeFocus:function(t,a){var n,r=t
if(a!=i&&""!=a){if(n=e(a).data("c"),n.width=r._convertActualPix(e(a).width()),n.height=r._convertActualPix(e(a).height()),n.top=r._convertActualPix(e(a).position().top),n.left=r._convertActualPix(e(a).position().left),e(a).data("c",n),r._updateMenuInputValue(a),!e(a).hasClass("bgimage"))ZK_JSC.Templ.prototype.setMenuEditStatus(r,!0)
if(e(a).hasClass("rect"))r.setMenuDisable("delete",!1)
r.selectedEle=a,e(".ZK-contentwrapper .paperframe .validarea").focus()}},_dragResizeBlur:function(t,a){var i=t,n=e(".ZK-contentwrapper .templpreview .menu #elementWidth"),r=e(".ZK-contentwrapper .templpreview .menu #elementHeight"),s=e(".ZK-contentwrapper .templpreview .menu #elementTop"),l=e(".ZK-contentwrapper .templpreview .menu #elementLeft"),o=e(".ZK-contentwrapper .templpreview .menu #elementAlias")
n.text(0),r.text(0),s.text(0),l.text(0),o.text(""),n.removeClass("editable").attr("contenteditable","false"),r.removeClass("editable").attr("contenteditable","false"),s.removeClass("editable").attr("contenteditable","false"),l.removeClass("editable").attr("contenteditable","false"),o.removeClass("editable").attr("contenteditable","false"),i.selectedEle=null,e(".ZK-contentwrapper .paperframe .validarea").blur(),i.setMenuDisable("delete")},_dragResizeMove:function(e,t,a){var i=e
i._dragResizeFocus(e,a)},_dragResizeEnd:function(e,t,a){var i=e
i._dragResizeFocus(e,a)},_moveElement:function(t,a,i){var n,r,s,i,l=this
if(e(a).find(".dragresize").remove(),e(a).hasClass("drsElementSelected"))e(a).removeClass("drsElementSelected")
if(!e(a).hasClass("barcode")&&!e(a).hasClass("qrcode"))e(a).children().remove()
s=e(a).prop("outerHTML"),n=e(a).data("c"),e(a).remove(),t.append(s),r=t.find("div.newelement:last"),r.data("c",n),r.css("top",i.top),r.css("left",i.left),l._renderElement(r)},_setMenuNextInputFocus:function(t){e(this).blur()
var a=e(this).parent().next().find("div.editable")
e(a).focus()},_updateSelectedElePosition:function(t,a){var i=this,n=e(t).data("c")
switch(a){case"left":n.left=parseFloat(n.left)-.1,n.left=n.left.toFixed(1),e(t).css("left",parseInt(i._convertActualPix(n.left)))
break
case"right":n.left=parseFloat(n.left)+.1,n.left=n.left.toFixed(1),e(t).css("left",parseInt(i._convertActualPix(n.left)))
break
case"up":n.top=parseFloat(n.top)-.1,n.top=n.top.toFixed(1),e(t).css("top",parseInt(i._convertActualPix(n.top)))
break
case"down":n.top=parseFloat(n.top)+.1,n.top=n.top.toFixed(1),e(t).css("top",parseInt(i._convertActualPix(n.top)))}e(t).data("c",n),i._updateMenuInputValue(t)},_insertListener:function(){var t=this
e(".ZK-contentwrapper .menu").on("mouseenter","div.menuitem",function(){if(!e(this).find("img").hasClass("disable"))e(this).addClass("hover")}).on("mouseleave","div.menuitem",function(){e(this).removeClass("hover")}),e(".ZK-contentwrapper .menu input#bgImage").get(0).onchange=t._loadBgImage,e(".ZK-contentwrapper .menu").on("click","div.menuitem",function(){if(!e(this).find("img").hasClass("disable")){var a=e(this).find("img").attr("class"),i=a.split(" ")[0]
switch(i){case"bgimage":break
case"bgremove":e(".ZK-contentwrapper .left .validarea .bgimage #ZK_BgImage").remove(),t.setMenuDisable("bgremove",!0)
break
case"rect":t._addTemplElement(i)
break
case"delete":if(t.selectedEle&&!e(t.selectedEle).hasClass("bgimage"))t.selectedEle.remove(),t._dragResizeBlur(t,t.selectedEle)}}}),e(".ZK-contentwrapper .menu .menuinput").on("keydown",function(a){var a=a||event
if(t.menuInputValue=e(this).text(),parseInt(t.menuInputValue)>1&&"0"==t.menuInputValue.charAt(0))t.menuInputValue=t.menuInputValue.substr(1)}),e(".ZK-contentwrapper .menu .menuinput").on("keyup",function(a){var a=a||event,i=e(this).text(),n=i.lastIndexOf(".")
if(-1!=n&&i.length-n>2)e(this).text(t.menuInputValue)
if(parseInt(i)>1&&"0"==i.charAt(0))i=i.substr(1),e(this).text(i)
var r=e(t.selectedEle).data("c"),s=e(this).parent().text()
switch(s=s.replace(i,"")){case"宽":e(t.selectedEle).css("width",t._convertActualPix(i)),r.width=i
break
case"高":e(t.selectedEle).css("height",t._convertActualPix(i)),r.height=i
break
case"上":e(t.selectedEle).css("top",parseInt(t._convertActualPix(i))),r.top=i
break
case"左":e(t.selectedEle).css("left",parseInt(t._convertActualPix(i))),r.left=i
break
case"别名":r.alias=i}e(t.selectedEle).data("c",r)}),e(".ZK-contentwrapper .menu .keypress1").on("keypress",function(t){var t=t||event,a=e(this).text()
if(13==t.keyCode){e(this).blur()
var i=e(this).parent().next().find("div.editable")
if(0==i.length)i=e(this).parent().siblings().first().find("div.editable")
return e(i).focus(),void t.preventDefault()}if(!(t.keyCode>=48&&t.keyCode<=57||46==t.keyCode&&a.split(".").length<=1))return void t.preventDefault()
else;}),e(".ZK-contentwrapper .menu .keypress2").on("keypress",function(t){var t=t||event
e(this).text()
if(13==t.keyCode){e(this).blur()
var a=e(this).parent().next().find("div.editable")
if(0==a.length)a=e(this).parent().siblings().first().find("div.editable")
return e(a).focus(),void t.preventDefault()}}),e(".ZK-contentwrapper .paperframe .validarea").on("keydown",function(e){e.preventDefault()}),e(".ZK-contentwrapper .paperframe .validarea").on("keyup",function(e){if(t.selectedEle)switch(e.keyCode){case 37:t._updateSelectedElePosition(t.selectedEle,"left")
break
case 39:t._updateSelectedElePosition(t.selectedEle,"right")
break
case 38:t._updateSelectedElePosition(t.selectedEle,"up")
break
case 40:t._updateSelectedElePosition(t.selectedEle,"down")}})}}}()
var n=ZK_JSC.ViewSetup={tabIndex:null,templObj:null,currentItemValue:"",viewSetupContainer:null,viewSetupCameraList:null,viewSetupCameraParms:null,init:function(t){var a=this
if(a.tabIndex=0,a.viewSetupContainer=t,!e(a.viewSetupContainer).children().length)a._setupWindow(),a._initCameraParmsWindow(),a._initCameraComboList(),a._insertListener()},_setupWindow:function(){var t=this,a='<div class="setview"><div class="cameralist"><div class="listwrapper"></div></div><div class="cameraparms"><div class="paramswrapper"></div></div><div class="combopopup"></div><div class="combomask"></div></div>'
e(t.viewSetupContainer).append(a),t.viewSetupCameraList=t.viewSetupContainer+" .cameralist .listwrapper",t.viewSetupCameraParms=t.viewSetupContainer+" .cameraparms .paramswrapper"},_initCameraParmsWindow:function(e){var t=this,a=[{name:"模板名",type:"input",value:"",editable:!0},{name:"类型",type:"combo",value:"",lists:"单次,常驻后台",editable:!1}]
t._setParmBlock("模板",a),a=[{name:"名称",type:"combo",value:"",lists:"",editable:!1},{name:"分辨率",type:"combo",value:"",lists:"",editable:!1},{name:"格式",type:"combo",value:"",lists:"MJPG,RGB24,RGB32,RGB8,YUY2",editable:!1}],t._setParmBlock("摄像头",a),a=[],t._setPreivewBlock("模板维护",a)},_setParmBlock:function(t,a,i){var n=this,r='<div class="paramblock"><div class="blocktitle"></div><div class="blockcontent"></div></div>'
if(e(n.viewSetupCameraParms).append(r),n._setParmBlockTitle(t,i),"object"==typeof a)a.forEach(function(e,t){n._setParmBlockItem(e)})},_setParmBlockTitle:function(t,a){var i=this
if(e(i.viewSetupCameraParms+" .blocktitle:last").text(t),a)e(i.viewSetupCameraParms+" .blocktitle:last").append("<span>"+a+"</span>")
e(i.viewSetupCameraParms+" .blocktitle:last").parent().attr("id",t)},_setParmBlockItem:function(t){var a=this,i=""
switch(t.type){case"combo":i='<div class="paramitem" type="combo"><div class="itemname">'+t.name+'</div><div class="itemvalue" contenteditable="true" tabindex="'+a.tabIndex+'">'+t.value+'</div><div class="combobtn"></div></div>',e(a.viewSetupCameraParms+" .blockcontent:last").append(i),e(a.viewSetupCameraParms+" .blockcontent:last .paramitem:last").attr("data",t.lists),e(a.viewSetupCameraParms+" .blockcontent:last .paramitem:last").attr("id",t.name)
break
case"spin":i='<div class="paramitem" type="spin"><div class="itemname">'+t.name+'</div><div class="itemvalue" tabindex="'+a.tabIndex+'" contenteditable="true">'+t.value+'</div><div class="spinbtn"><div class="spinup"></div><div class="spindown"></div></div>',e(a.viewSetupCameraParms+" .blockcontent:last").append(i),e(a.viewSetupCameraParms+" .blockcontent:last .paramitem:last").attr("id",t.name)
break
case"input":default:i='<div class="paramitem" type="input"><div class="itemname">'+t.name+'</div><div class="itemvalue">'+t.value+"</div></div>",e(a.viewSetupCameraParms+" .blockcontent:last").append(i),e(a.viewSetupCameraParms+" .blockcontent:last .paramitem:last").attr("id",t.name)}if(t.editable)e(a.viewSetupCameraParms+" .itemvalue:last").addClass("editable").attr("contenteditable","true")
a.tabIndex++},_setPreivewBlock:function(t,a){var i=this,n='<div class="previewblock"><div class="blocktitle"></div><div id="ZK-TemplPreview" class="blockcontent"></div></div>'
e(i.viewSetupCameraParms).append(n),i._setParmBlockTitle(t),i._initPreviewContent()},_initPreviewContent:function(){var e,t=this
e=t.viewSetupCameraParms+" #ZK-TemplPreview",t.templObj=new ZK_JSC.Templ(e,{x:210,y:105},!0)},updateTemplNameList:function(t){var a,n=this,r="",s=""
if(a=n._getTemplNameList(),0!=e(n.viewSetupCameraList).children().length)s=n._getSelectedTemplName(),e(n.viewSetupCameraList).children().remove()
if("object"==typeof a)a.forEach(function(t,a){r='<div class="cameraitem"><span>'+t+"</span></div>",e(n.viewSetupCameraList).append(r)})
n._setTemplItemSelected(t==i?s:t)},_getTemplNameList:function(){var e=[]
return ZK_JSC.TemplsData.forEach(function(t,a){e.unshift(t.name)}),e},getTemplContent:function(){var e=this
return ZK_JSC.PreviewData=e.templObj.getPreviewContent(),ZK_JSC.PrivateData=e.templObj.getPreviewPrivate(),ZK_JSC.ParamData=e._getParamContent(),ZK_JSC.TemplData.name=e._filterTemplName(ZK_JSC.ParamData),ZK_JSC.TemplData.preview=ZK_JSC.PreviewData.concat(),ZK_JSC.TemplData["private"]=ZK_JSC.PrivateData.concat(),ZK_JSC.TemplData.params=ZK_JSC.ParamData.concat(),ZK_JSC.TemplData},_filterTemplName:function(e){if("object"==typeof e)return e.forEach(function(e,t){if("模板名"==e.name)return tempName=e.value,!1
else;}),tempName},_getParamContent:function(){var t=this,a=[]
return $paramswrapper=e(".ZK-contentwrapper .cameraparms .paramblock .paramitem .itemvalue"),$paramswrapper.each(function(i,n){itemName=t._getCurrentInputName(n),itemValue=e(n).text(),itemData=e(n).parent().attr("data"),a.push({name:itemName,value:itemValue})}),a},_setTemplItemSelected:function(t){var a,n=this
if(a=e(n.viewSetupCameraList+" .cameraitem"),t==i||""==t)a.first().addClass("selected"),t=a.first().text()
a.each(function(i,r){if(t==e(r).text())return e(a[i]).addClass("selected"),n._loadTemplContent(t),!1
else;})},_getSelectedTemplName:function(){var t,a,i=this
return a=e(i.viewSetupCameraList+" .cameraitem"),a.each(function(a,i){if(e(i).hasClass("selected"))return t=e(e(this).find("span")[0]).text(),!1
else;}),t},_loadTemplContent:function(e){var t=this
ZK_JSC.TemplsData.forEach(function(a,i){if(a.name==e)return t._updateParamValue(a.params),t.templObj.setPreviewContent(a.preview),t.templObj.setPreviewPrivate(a["private"]),!1
else;})},_updateParamValue:function(t){var a,n,r=this
n=e(".ZK-contentwrapper .cameraparms .paramblock .paramitem .itemvalue"),n.each(function(n,s){if(a=r._getCurrentInputName(s),itemValue=r._getTemplParamValue(a,t),e(s).text(itemValue.value),""!=itemValue.lists||itemValue.lists!=i)$paramItemWrapper=e(s).parent(),$paramItemWrapper.attr("data",itemValue.lists)})},_getTemplParamValue:function(e,t){var a,i={name:"",type:"",value:"",lists:"",editable:!1}
if(a=e,"object"!=typeof t)return""
else return t.forEach(function(e,t){if(e.name==a)return i=e,!1
else;}),i},_initCameraComboList:function(){var e=this
e._setItemLists("名称",ZK_JSC.CameraList)},_focusToNextInput:function(t,a){var n,r,s,l,o=t,p=e(".combopopup")
if(a==i)a=!0
if(e(o).blur(),p.hide(),e(".combomask").hide(),n=e(".ZK-contentwrapper .cameraparms .paramblock .paramitem .itemvalue[contenteditable='true']").parent(),s=e(e(o).parent().find(".itemname")[0]).text(),n.each(function(t,i){if(l=e(e(i).find(".itemname")[0]).text(),s==l){if(a)if(t==n.length-1)r=e(n[0]).find(".itemvalue")[0]
else r=e(n[t+1]).find(".itemvalue")[0]
else if(0==t)r=e(n[n.length-1]).find(".itemvalue")[0]
else r=e(n[t-1]).find(".itemvalue")[0]
return!1}}),!e(r).hasClass("editable")){var m=e(r).parent().attr("data"),c="#"+e(e(r).parentsUntil(".paramblock").parent()[0]).attr("id")+" #"+e(r).parent().attr("id")
e(r).focus(),ZK_JSC.ViewSetup._showComboBox(c,m)}else e(r).focus()},_setSelectedPopItem:function(t){var a=e(".combopopup"),i=a.find(".hover")
if(i.length>=1)e(t).text(e(i[0]).text())},_getCurrentInputName:function(t){return e(e(t).parent().find(".itemname")[0]).text()},_getRelativeItem:function(t,a,n){var r,s
if(n==i)n=!0
if(0==a.length)r=t[0]
else s=a.text(),t.each(function(a,i){if(itemName=e(i).text(),s==itemName){if(n)if(a==t.length-1)r=t[0]
else r=t[a+1]
else if(0==a)r=t[t.length-1]
else r=t[a-1]
return!1}})
return r},_parseSizeString:function(e,t){var a,i,n=e,r={}
if(i=!0,t=t.replace("：",":"),a=t.split("|"),a.length!=n.length)return!1
if(a.forEach(function(e,t){var a=e.split(":")
if(2!=a.length)return i&=!1,!0
if(-1==n.indexOf(a[0]))i&=!1
else r[a[0]]=a[1]}),i)return r
else return!1},_removeCameraItem:function(e){var t=this
ZK_JSC.TemplsData.forEach(function(a,i){if(a.name==e)return ZK_JSC.TemplsData.splice(i,1),t.updateTemplNameList(),!1
else;})},_insertListener:function(){var t=this
e(t.viewSetupCameraList).on("click","div.cameraitem",function(){e(this).siblings().removeClass("selected"),e(this).addClass("selected"),t._loadTemplContent(e(e(this).find("span")[0]).text())}),e(t.viewSetupCameraList).on("click","div.hover",function(){var a=e(this).parent()
if(a.hasClass("selected")){var i=a.parent().find(".cameraitem"),n=a.index(),r=e(i[n+1])
r.addClass("selected"),r.siblings().removeClass("selected"),t._loadTemplContent(r.text())}t._removeCameraItem(e(a.find("span")[0]).text()),a.remove()}),e(t.viewSetupCameraList).on("mouseenter","div.cameraitem",function(){if("新增"!=e(this).text()){var t='<div class="hover">删除</div>'
e(this).append(t)}}).on("mouseleave","div.cameraitem",function(){e(t.viewSetupCameraList+" .cameraitem").find(".hover").remove()}),e(t.viewSetupCameraParms).on("click","div.combobtn",function(){var a=e(this).parent().attr("data"),i="#"+e(e(this).parentsUntil(".paramblock").parent()[0]).attr("id")+" #"+e(this).parent().attr("id")
t._showComboBox(i,a)}),e(t.viewSetupCameraParms).on("click","div.spinup",function(){var t=e(this).parent().parent().find(".itemvalue").text()
t=parseInt(t)+1,e(this).parent().parent().find(".itemvalue").text(t)}),e(t.viewSetupCameraParms).on("click","div.spindown",function(){var t=e(this).parent().parent().find(".itemvalue").text()
if(t=parseInt(t)-1,0>=t)t=1
e(this).parent().parent().find(".itemvalue").text(t)}),e(".combopopup").on("click",".popupitem",function(t){var a=e(this).parent().attr("target")
e(a).text(e(this).text()),e(".combopopup").hide(),e(".combomask").hide()}),e(".combomask").on("click",function(t){e(".combopopup").hide(),e(this).hide()}),e(".ZK-contentwrapper .cameraparms .paramblock .paramitem").on("keypress","div.itemvalue",function(a){var a=a||event
if("true"==e(this).attr("contenteditable")&&!e(this).hasClass("editable")&&13!=a.keyCode){var i=e(".combopopup")
return i.hide(),e(".combomask").hide(),void a.preventDefault()}if("true"==e(this).attr("contenteditable")&&!e(this).hasClass("editable")&&13==a.keyCode){var i=e(".combopopup")
t._setSelectedPopItem(this),i.hide(),e(".combomask").hide(),a.preventDefault()}if(13==a.keyCode){if(e(t.viewSetupContainer+" .ZK-mask").length)e(t.viewSetupContainer+" .ZK-mask").remove()
return t._focusToNextInput(this),void a.preventDefault()}}),e(".ZK-contentwrapper .cameraparms .paramblock .paramitem").on("keyup","div:not(.editable)",function(a){var i,n,r,s=e(".ZK-contentwrapper .setview .combopopup")
switch(n=s.find(".hover"),i=s.children(),a.keyCode){case 40:r=t._getRelativeItem(i,n)
break
case 38:r=t._getRelativeItem(i,n,!1)}e(r).siblings().removeClass("hover"),e(r).addClass("hover")}),e(".ZK-contentwrapper .cameraparms .paramblock .paramitem").on("keyup","div.itemvalue",function(a){var i=0
if(13!=a.keyCode&&e(t.viewSetupContainer+" .ZK-mask").length)e(t.viewSetupContainer+" .ZK-mask").remove()
switch(a.keyCode){case 37:if(!e(this).hasClass("editable"))t._setSelectedPopItem(this),t._focusToNextInput(this,!1)
else if(i=e(this).getCursorPosition(),0==i)t._focusToNextInput(this,!1)
break
case 39:if(!e(this).hasClass("editable"))t._setSelectedPopItem(this),t._focusToNextInput(this)
else if(i=e(this).getCursorPosition(),i==e(this).text().length)t._focusToNextInput(this)}}),e(".ZK-contentwrapper .cameraparms .paramblock .paramitem").on("focus","div.itemvalue",function(a){t.currentItemValue=e(this).text()}),e(".ZK-contentwrapper .cameraparms .paramblock .paramitem").on("DOMNodeInserted","div:not(.editable)",function(a){var i,n
switch(i=t._getCurrentInputName(this),n=e(this).text(),i){case"名称":t._resetListContent(n)
break
case"类型":t.templType=n}})},_resetListContent:function(e){var t,a,i=this
ZK_JSC.CameraInfo.forEach(function(n,r){if(n.camera==e)t=n.name,a=n.lists,i._setItemLists(t,a)})},_setItemLists:function(t,a){var i,n,r=e(".ZK-contentwrapper .cameraparms .paramblock .paramitem")
r.each(function(r,s){if(i=e(s).find(".itemname").text(),n=e(s).attr("type"),i==t){if("combo"==n)if(e(s).attr("data",a),1==a.split(",").length)e(e(s).find(".itemvalue")[0]).text(a)
else e(e(s).find(".itemvalue")[0]).text("")
else e(e(s).find(".itemvalue")[0]).text(a)
return!1}})},_showComboBox:function(t,a,n,r){var s,l=this,o=e(".combopopup")
if(n==i)n=!0
if(r==i)r=!0
if(s=t+" .itemvalue",l._addComboItem(a),o.attr("target",s),r){var p=e(s).offset().left,m=e(s).width(),c=e(s).offset().top+e(s).height()+7,d=e(l.viewSetupContainer).height()-c+e(l.viewSetupContainer).offset().top
if(o.show().css({display:"block",width:m,"max-height":d}).offset({top:c,left:p}),n)e(".combomask").show().css("height",e(l.viewSetupContainer).height())}else o.hide(),e(".combomask").hide()},_addComboItem:function(t){var a,n=e(".combopopup")
if(n.children().remove(),""!=t&&t!=i)if(a=t.split(","),"object"==typeof a)a.forEach(function(e,t){item='<div class="popupitem">'+e+"</div>",n.append(item)})}}
ZK_JSC.View={httpObj:null,formObj:null,cbInit:!1,init:function(e){var t=this
t.httpObj=new ZK_JSC.Http,t.formObj=new ZK_JSC.Form(null),t.check(e)},check:function(e){var t=this
t.cbInit=e,t.httpObj.AjaxGetHandle("check",null,t.cbCheck)},cbCheck:function(e){var t=ZK_JSC.View
if(200!=e.status)t.isServiceReady=!1,console.log("JsCameraSrv is not ready")
else t.isServiceReady=!0,t._patchDeviceParams(e.data)
if("function"==typeof t.cbInit)t.cbInit(t.isServiceReady)
t.httpObj.AjaxGetHandle("setup/load",ZK_JSC.TemplsData,t.cbGotTempl)},_patchDeviceParams:function(e){var t,a,i,n=null,r=null,s=null
ZK_JSC.TemplsData.forEach(function(e,t){if("新增"==e.name)return n=e,!1
else;}),r=n.params,r.forEach(function(e,t){if("名称"==e.name)return s=e,!1
else;}),t=/\{(.+?)\}/gi,a=e.match(t)
for(var l=0;l<a.length;l++)if(i=JSON.parse(a[l]),"所有"==i.camera)s.lists=i.lists,ZK_JSC.CameraList=i.lists
else ZK_JSC.CameraInfo.push(i)},cbGotTempl:function(e){var t=ZK_JSC.View
if(200!=e.status)t.isServiceReady=!1
else if(e.errMsg==i)ZK_JSC.TemplsData.splice(1,ZK_JSC.TemplsData.length-1),e.forEach(function(e,t){ZK_JSC.TemplsData.push(e)})},setup:function(){var e=this
e.formObj.create("模板设置",null,null,null),memus=["确定","取消"],e.formObj.setupBtns(memus,e.cbMainFrame,e),n.init(e.formObj.getContentWarpper()),ZK_JSC.ViewSetup.updateTemplNameList(),e.formObj.show()},cbMainFrame:function(e,t){var a,i=e
if("确定"==t)if(a=n.getTemplContent(),""==a.name)return void i.formObj.showBusyMask(".ZK-contentwrapper","请输入模板名称","warning")
else newTemplName=i._updateTemplsData(a),i._uploadTemplsData(),n.updateTemplNameList(newTemplName)
else i.formObj.close()},_updateTemplsData:function(t){var a
if(isExisted=!1,ZK_JSC.TemplsData.forEach(function(e,i){if(e.name==t.name)return isExisted=!0,a=i,!1
else;}),isExisted)ZK_JSC.TemplsData.splice(a,1)
return ZK_JSC.TemplsData.push(e.extend({},t)),t.name},getTempls:function(){var e=[]
return ZK_JSC.TemplsData.forEach(function(t,a){if("新增"!=t.name)e.unshift(t.name)}),e},start:function(e,t){var a=this
if("function"==typeof t)a.httpObj.AjaxPostHandle("start",JSON.stringify(e),t)
else a.httpObj.AjaxPostHandle("start",JSON.stringify(e))},get:function(e){var t=this
if("function"==typeof e)t.httpObj.AjaxGetHandle("get",null,e)},status:function(e){var t=this
if("function"==typeof e)t.httpObj.AjaxGetHandle("status",null,e)},_uploadTemplsData:function(){var e=this,t=ZK_JSC.TemplsData.concat()
for(index in t)if("新增"==t[index].name)t.splice(index,1)
var a=JSON.stringify(t)
e.httpObj.AjaxPostHandle("setup/save",a,e.cbUploadTempl),e.formObj.showBusyMask(".ZK-contentwrapper","正在处理","")},cbUploadTempl:function(e){if("success"==e.result)ZK_JSC.View.formObj.showBusyMask(".ZK-contentwrapper","","")
else ZK_JSC.View.formObj.showBusyMask(".ZK-contentwrapper",e.errMsg,"warning",2e3)}}}(jQuery,window,document)
